(function(d){elFinder=function(e,c){function b(a,b){a&&g.view.win.width(a);b&&g.view.nav.add(g.view.cwd).height(b)}function a(){b(null,g.dialog.height()-g.view.tlb.parent().height()-(d.browser.msie?47:32))}var g=this,h;this.log=function(a){window.console&&window.console.log&&window.console.log(a)};this.options=d.extend({},this.options,c||{});if(this.options.url){this.id="";if(h=d(e).attr("id"))this.id=h;this.version="1.2";this.jquery=d.fn.jquery.split(".").join("");this.cwd={};this.cdc={};this.buffer=
{};this.selected=[];this.history=[];this.locked=!1;this.zIndex=2;this.dialog=null;this.anchor=this.options.docked?d("<div/>").hide().insertBefore(e):null;this.params={dotFiles:!1,arc:"",uplMaxSize:""};this.vCookie="el-finder-view-"+this.id;this.pCookie="el-finder-places-"+this.id;this.lCookie="el-finder-last-"+this.id;this.view=new this.view(this,e);this.ui=new this.ui(this);this.eventsManager=new this.eventsManager(this);this.quickLook=new this.quickLook(this);this.cookie=function(a,b){if("undefined"==
typeof b){if(document.cookie&&""!=document.cookie){var c,g=document.cookie.split(";"),a=a+"=";for(c=0;c<g.length;c++)if(g[c]=d.trim(g[c]),g[c].substring(0,a.length)==a)return decodeURIComponent(g[c].substring(a.length))}return""}g=d.extend({},this.options.cookie);null===b&&(b="",g.expires=-1);"number"==typeof g.expires&&(c=new Date,c.setTime(c.getTime()+864E5*g.expires),g.expires=c);document.cookie=a+"="+encodeURIComponent(b)+"; expires="+g.expires.toUTCString()+(g.path?"; path="+g.path:"")+(g.domain?
"; domain="+g.domain:"")+(g.secure?"; secure":"")};this.lock=function(a){this.view.spinner(this.locked=a||!1);this.eventsManager.lock=this.locked};this.lockShortcuts=function(a){this.eventsManager.lock=!!a};this.setView=function(a){if("list"==a||"icons"==a)this.options.view=a,this.cookie(this.vCookie,a)};this.ajax=function(a,b,c){var h={url:this.options.url,async:!0,type:"GET",data:a,dataType:"json",cache:!1,lock:!0,force:!1,silent:!1};"object"==typeof c&&(h=d.extend({},h,c));h.silent||(h.error=g.view.fatal);
h.success=function(a){h.lock&&g.lock();if(a){a.debug&&g.log(a.debug);if(a.error&&(!h.silent&&g.view.error(a.error,a.errorData),!h.force))return;b(a);delete a}};h.lock&&this.lock(!0);d.ajax(h)};this.tmb=function(){this.ajax({cmd:"tmb",current:g.cwd.hash},function(a){if("icons"==g.options.view&&a.images&&a.current==g.cwd.hash){for(var b in a.images)g.cdc[b]&&(g.cdc[b].tmb=a.images[b],d('div[key="'+b+'"]>p',g.view.cwd).css("background",' url("'+a.images[b]+'") 0 0 no-repeat'));a.tmb&&g.tmb()}},{lock:!1,
silent:!0})};this.getPlaces=function(){var a=[],b=this.cookie(this.pCookie);b.length&&(-1!=b.indexOf(":")?a=b.split(":"):a.push(b));return a};this.addPlace=function(a){var b=this.getPlaces();if(-1==d.inArray(a,b))return b.push(a),this.savePlaces(b),!0};this.removePlace=function(a){var b=this.getPlaces();if(-1!=d.inArray(a,b))return this.savePlaces(d.map(b,function(b){return b==a?null:b})),!0};this.savePlaces=function(a){this.cookie(this.pCookie,a.join(":"))};this.reload=function(a){var b;this.cwd=
a.cwd;this.cdc={};for(b=0;b<a.cdc.length;b++)a.cdc[b].hash&&a.cdc[b].name&&(this.cdc[a.cdc[b].hash]=a.cdc[b],this.cwd.size+=a.cdc[b].size);a.tree&&(this.view.renderNav(a.tree),this.eventsManager.updateNav());this.updateCwd();a.tmb&&(!g.locked&&"icons"==g.options.view)&&g.tmb();if(a.select&&a.select.length)for(b=a.select.length;b--;)this.cdc[a.select[b]]&&this.selectById(a.select[b]);this.lastDir(this.cwd.hash);0<this.options.autoReload&&(this.iID&&clearInterval(this.iID),this.iID=setInterval(function(){!g.locked&&
g.ui.exec("reload")},6E4*this.options.autoReload))};this.updateCwd=function(){this.lockShortcuts(!0);this.selected=[];this.view.renderCwd();this.eventsManager.updateCwd();this.view.tree.find('a[key="'+this.cwd.hash+'"]').trigger("select");this.lockShortcuts()};this.drop=function(a,b,c){if(b.helper.find('[key="'+c+'"]').length)return g.view.error("Unable to copy into itself");var h=[];b.helper.find('div:not(.noaccess):has(>label):not(:has(em[class="readonly"],em[class=""]))').each(function(){h.push(d(this).hide().attr("key"))});
b.helper.find("div:has(>label):visible").length||b.helper.hide();h.length?(g.setBuffer(h,a.shiftKey?0:1,c),g.buffer.files&&setTimeout(function(){g.ui.exec("paste");g.buffer={}},300)):d(this).removeClass("el-finder-droppable")};this.getSelected=function(a){var b=[];if(0<=a)return this.cdc[this.selected[a]]||{};for(a=0;a<this.selected.length;a++)this.cdc[this.selected[a]]&&b.push(this.cdc[this.selected[a]]);return b};this.select=function(a,b){b&&d(".ui-selected",g.view.cwd).removeClass("ui-selected");
a.addClass("ui-selected");g.updateSelect()};this.selectById=function(a){a=d('[key="'+a+'"]',this.view.cwd);a.length&&(this.select(a),this.checkSelectedPos())};this.unselect=function(a){a.removeClass("ui-selected");g.updateSelect()};this.toggleSelect=function(a){a.toggleClass("ui-selected");this.updateSelect()};this.selectAll=function(){d("[key]",g.view.cwd).addClass("ui-selected");g.updateSelect()};this.unselectAll=function(){d(".ui-selected",g.view.cwd).removeClass("ui-selected");g.updateSelect()};
this.updateSelect=function(){g.selected=[];d(".ui-selected",g.view.cwd).each(function(){g.selected.push(d(this).attr("key"))});g.view.selectedInfo();g.ui.update();g.quickLook.update()};this.checkSelectedPos=function(a){var b=g.view.cwd.find(".ui-selected:"+(a?"last":"first")).eq(0),a=b.position(),b=b.outerHeight(),c=g.view.cwd.height();0>a.top?g.view.cwd.scrollTop(a.top+g.view.cwd.scrollTop()-2):c-a.top<b&&g.view.cwd.scrollTop(a.top+b-c+g.view.cwd.scrollTop())};this.setBuffer=function(a,b,c){this.buffer=
{src:this.cwd.hash,dst:c,files:[],names:[],cut:b||0};for(b=0;b<a.length;b++)if(c=a[b],(c=this.cdc[c])&&c.read&&"link"!=c.type)this.buffer.files.push(c.hash),this.buffer.names.push(c.name);this.buffer.files.length||(this.buffer={})};this.isValidName=function(a){return!this.cwd.dotFiles&&0==a.indexOf(".")?!1:a.match(/^[^\\\/\<\>:]+$/)};this.fileExists=function(a){for(var b in this.cdc)if(this.cdc[b].name==a)return b;return!1};this.uniqueName=function(a,b){var c=a=g.i18n(a),d=0,b=b||"";if(!this.fileExists(c+
b))return c+b;for(;100>d++;)if(!this.fileExists(c+d+b))return c+d+b;return c.replace("100","")+Math.random()+b};this.lastDir=function(a){if(this.options.rememberLastDir)return a?this.cookie(this.lCookie,a):this.cookie(this.lCookie)};this.time=function(){return(new Date).getMilliseconds()};this.setView(this.cookie(this.vCookie));b(g.options.width,g.options.height);if(this.options.dialog||this.options.docked)this.options.dialog=d.extend({width:570,dialogClass:"",minWidth:480,minHeight:330},this.options.dialog||
{}),this.options.dialog.open=function(){setTimeout(function(){d('<input type="text" value="f"/>').appendTo(g.view.win).focus().select().remove()},200)},this.options.dialog.dialogClass+="el-finder-dialog",this.options.dialog.resize=a,this.options.docked?(this.options.dialog.close=function(){g.dock()},this.view.win.data("size",{width:this.view.win.width(),height:this.view.nav.height()})):(this.options.dialog.close=function(){g.destroy()},this.dialog=d("<div/>").append(this.view.win).dialog(this.options.dialog));
this.ajax({cmd:"open",target:this.lastDir()||"",init:!0,tree:!0},function(a){a.cwd&&(g.eventsManager.init(),g.reload(a),d.extend(g.params,a.params||{}),d("*",document.body).each(function(){var a=parseInt(d(this).css("z-index"));a>=g.zIndex&&(g.zIndex=a+1)}),g.ui.init(a.disabled))},{force:!0});this.open=function(){this.dialog?this.dialog.dialog("open"):this.view.win.show();this.eventsManager.lock=!1};this.close=function(){this.quickLook.hide();this.options.docked&&this.view.win.attr("undocked")?this.dock():
this.dialog?this.dialog.dialog("close"):this.view.win.hide();this.eventsManager.lock=!0};this.destroy=function(){this.eventsManager.lock=!0;this.quickLook.hide();this.quickLook.win.remove();this.dialog?(this.dialog.dialog("destroy"),this.view.win.parent().remove()):this.view.win.remove();this.ui.menu.remove()};this.dock=function(){if(this.options.docked&&this.view.win.attr("undocked")){this.quickLook.hide();var a=this.view.win.data("size");this.view.win.insertAfter(this.anchor).removeAttr("undocked");
b(a.width,a.height);this.dialog.dialog("destroy");this.dialog=null}};this.undock=function(){this.options.docked&&!this.view.win.attr("undocked")&&(this.quickLook.hide(),this.dialog=d("<div/>").append(this.view.win.css("width","100%").attr("undocked",!0).show()).dialog(this.options.dialog),a())}}else alert("Invalid configuration! You have to set URL option.")};elFinder.prototype.i18n=function(d){return this.options.i18n[this.options.lang]&&this.options.i18n[this.options.lang][d]?this.options.i18n[this.options.lang][d]:
d};elFinder.prototype.options={url:"",lang:"en",cssClass:"",wrap:14,places:"Places",placesFirst:!0,editorCallback:null,cutURL:"",closeOnEditorCallback:!0,i18n:{},view:"icons",width:"",height:"",disableShortcuts:!1,rememberLastDir:!0,cookie:{expires:30,domain:"",path:"/",secure:!1},toolbar:[["back","reload"],["select","open"],["mkdir","mkfile","upload"],["copy","paste","rm"],["rename","edit"],["info","quicklook","resize"],["icons","list"],["help"]],contextmenu:{cwd:"reload delim mkdir mkfile upload delim paste delim info".split(" "),
file:"select open quicklook delim copy cut rm delim duplicate rename edit resize archive extract delim info".split(" "),group:"select copy cut rm delim archive extract delim info".split(" ")},dialog:null,docked:!1,autoReload:0,selectMultiple:!1};d.fn.elfinder=function(d){return this.each(function(){var c="string"==typeof d?d:"";this.elfinder||(this.elfinder=new elFinder(this,"object"==typeof d?d:{}));switch(c){case "close":case "hide":this.elfinder.close();break;case "open":case "show":this.elfinder.open();
break;case "dock":this.elfinder.dock();break;case "undock":this.elfinder.undock();break;case "destroy":this.elfinder.destroy()}})}})(jQuery);
(function(d){elFinder.prototype.view=function(e,c){var b=this;this.fm=e;this.kinds={unknown:"Unknown",directory:"Folder",symlink:"Alias","symlink-broken":"Broken alias","application/x-empty":"Plain text","application/postscript":"Postscript document","application/octet-stream":"Application","application/vnd.ms-office":"Microsoft Office document","application/vnd.ms-word":"Microsoft Word document","application/vnd.ms-excel":"Microsoft Excel document","application/vnd.ms-powerpoint":"Microsoft Powerpoint presentation",
"application/pdf":"Portable Document Format (PDF)","application/vnd.oasis.opendocument.text":"Open Office document","application/x-shockwave-flash":"Flash application","application/xml":"XML document","application/x-bittorrent":"Bittorrent file","application/x-7z-compressed":"7z archive","application/x-tar":"TAR archive","application/x-gzip":"GZIP archive","application/x-bzip2":"BZIP archive","application/zip":"ZIP archive","application/x-rar":"RAR archive","application/javascript":"Javascript application",
"text/plain":"Plain text","text/x-php":"PHP source","text/html":"HTML document","text/javascript":"Javascript source","text/css":"CSS style sheet","text/rtf":"Rich Text Format (RTF)","text/rtfd":"RTF with attachments (RTFD)","text/x-c":"C source","text/x-c++":"C++ source","text/x-shellscript":"Unix shell script","text/x-python":"Python source","text/x-java":"Java source","text/x-ruby":"Ruby source","text/x-perl":"Perl script","text/xml":"XML document","image/x-ms-bmp":"BMP image","image/jpeg":"JPEG image",
"image/gif":"GIF Image","image/png":"PNG image","image/x-targa":"TGA image","image/tiff":"TIFF image","image/vnd.adobe.photoshop":"Adobe Photoshop image","audio/mpeg":"MPEG audio","audio/midi":"MIDI audio","audio/ogg":"Ogg Vorbis audio","audio/mp4":"MP4 audio","audio/wav":"WAV audio","video/x-dv":"DV video","video/mp4":"MP4 video","video/mpeg":"MPEG video","video/x-msvideo":"AVI video","video/quicktime":"Quicktime video","video/x-ms-wmv":"WM video","video/x-flv":"Flash video","video/x-matroska":"Matroska video"};
this.tlb=d("<ul />");this.nav=d('<div class="el-finder-nav"/>').resizable({handles:"e",autoHide:!0,minWidth:200,maxWidth:500});this.cwd=d('<div class="el-finder-cwd"/>').attr("unselectable","on");this.spn=d('<div class="el-finder-spinner"/>');this.err=d('<p class="el-finder-err"><strong/></p>').click(function(){d(this).hide()});this.nfo=d('<div class="el-finder-stat"/>');this.pth=d('<div class="el-finder-path"/>');this.sel=d('<div class="el-finder-sel"/>');this.stb=d('<div class="el-finder-statusbar"/>').append(this.pth).append(this.nfo).append(this.sel);
this.wrz=d('<div class="el-finder-workzone" />').append(this.nav).append(this.cwd).append(this.spn).append(this.err).append('<div style="clear:both" />');this.win=d(c).empty().attr("id",this.fm.id).addClass("el-finder "+(e.options.cssClass||"")).append(d('<div class="el-finder-toolbar" />').append(this.tlb)).append(this.wrz).append(this.stb);this.tree=d('<ul class="el-finder-tree"></ul>').appendTo(this.nav);this.plc=d('<ul class="el-finder-places"><li><a href="#" class="el-finder-places-root"><div/>'+
this.fm.i18n(this.fm.options.places)+"</a><ul/></li></ul>").hide();this.nav[this.fm.options.placesFirst?"prepend":"append"](this.plc);this.spinner=function(a){this.win.toggleClass("el-finder-disabled",a);this.spn.toggle(a)};this.fatal=function(a){b.error("404"!=a.status?"Invalid backend configuration":"Unable to connect to backend")};this.error=function(a,c){this.fm.lock();this.err.show().children("strong").html(this.fm.i18n(a)+"!"+this.formatErrorData(c));setTimeout(function(){b.err.fadeOut("slow")},
4E3)};this.renderNav=function(a){function b(a){var c,d,h='<ul style="display:none">';for(c=0;c<a.length;c++)a[c].name&&a[c].hash&&(d="",!a[c].read&&!a[c].write?d="noaccess":a[c].read?a[c].write||(d="readonly"):d="dropbox",h+='<li><a href="#" class="'+d+'" key="'+a[c].hash+'"><div'+(a[c].dirs.length?' class="collapsed"':"")+"/>"+a[c].name+"</a>",a[c].dirs.length&&(h+=b(a[c].dirs)),h+="</li>");return h+"</ul>"}var c=a.dirs.length?b(a.dirs):"";this.tree.html('<li><a href="#" class="el-finder-tree-root" key="'+
a.hash+'"><div'+(c?' class="collapsed expanded"':"")+"/>"+a.name+"</a>"+c+"</li>");this.fm.options.places&&this.renderPlaces()};this.renderPlaces=function(){var a,c,h=this.fm.getPlaces(),j=this.plc.show().find("ul").empty().hide();d("div:first",this.plc).removeClass("collapsed expanded");if(h.length){h.sort(function(a,c){var d=b.tree.find('a[key="'+a+'"]').text()||"",g=b.tree.find('a[key="'+c+'"]').text()||"";return d.localeCompare(g)});for(a=0;a<h.length;a++)(c=this.tree.find('a[key="'+h[a]+'"]:not(.dropbox)').parent())&&
c.length?j.append(c.clone().children("ul").remove().end().find("div").removeClass("collapsed expanded").end()):this.fm.removePlace(h[a]);j.children().length&&d("div:first",this.plc).addClass("collapsed")}};this.renderCwd=function(){this.cwd.empty();var a=0,b=0,c="",d;for(d in this.fm.cdc)a++,b+=this.fm.cdc[d].size,c+="icons"==this.fm.options.view?this.renderIcon(this.fm.cdc[d]):this.renderRow(this.fm.cdc[d],a%2);"icons"==this.fm.options.view?this.cwd.append(c):this.cwd.append('<table><tr><th colspan="2">'+
this.fm.i18n("Name")+"</th><th>"+this.fm.i18n("Permissions")+"</th><th>"+this.fm.i18n("Modified")+'</th><th class="size">'+this.fm.i18n("Size")+"</th><th>"+this.fm.i18n("Kind")+"</th></tr>"+c+"</table>");this.pth.text(e.cwd.rel);this.nfo.text(e.i18n("items")+": "+a+", "+this.formatSize(b));this.sel.empty()};this.renderIcon=function(a){var b="<p"+(a.tmb?" style=\"background:url('"+a.tmb+"') 0 0 no-repeat\"":"")+"/><label>"+this.formatName(a.name)+"</label>";if(a.link||"symlink-broken"==a.mime)b+="<em/>";
!a.read&&!a.write?b+='<em class="noaccess"/>':a.read&&!a.write?b+='<em class="readonly"/>':!a.read&&a.write&&(b+='<em class="'+("directory"==a.mime?"dropbox":"noread")+'" />');return'<div class="'+this.mime2class(a.mime)+'" key="'+a.hash+'">'+b+"</div>"};this.renderRow=function(a,c){var d=a.link||"symlink-broken"==a.mime?"<em/>":"";!a.read&&!a.write?d+='<em class="noaccess"/>':a.read&&!a.write?d+='<em class="readonly"/>':!a.read&&a.write&&(d+='<em class="'+("directory"==a.mime?"dropbox":"noread")+
'" />');return'<tr key="'+a.hash+'" class="'+b.mime2class(a.mime)+(c?" el-finder-row-odd":"")+'"><td class="icon"><p>'+d+"</p></td><td>"+a.name+"</td><td>"+b.formatPermissions(a.read,a.write,a.rm)+"</td><td>"+b.formatDate(a.date)+'</td><td class="size">'+b.formatSize(a.size)+"</td><td>"+b.mime2kind(a.link?"symlink":a.mime)+"</td></tr>"};this.updateFile=function(a){var b=this.cwd.find('[key="'+a.hash+'"]');b.replaceWith("DIV"==b[0].nodeName?this.renderIcon(a):this.renderRow(a))};this.selectedInfo=
function(){var a,c=0,d;if(b.fm.selected.length){d=this.fm.getSelected();for(a=0;a<d.length;a++)c+=d[a].size}this.sel.text(0<a?this.fm.i18n("selected items")+": "+d.length+", "+this.formatSize(c):"")};this.formatName=function(a){var c=b.fm.options.wrap;if(0<c){if(a.length>2*c)return a.substr(0,c)+"&shy;"+a.substr(c,c-5)+"&hellip;"+a.substr(a.length-3);if(a.length>c)return a.substr(0,c)+"&shy;"+a.substr(c)}return a};this.formatErrorData=function(a){var c,d="";if("object"==typeof a)for(c in d="<br />",
a)d+=c+" "+b.fm.i18n(a[c])+"<br />";return d};this.mime2class=function(a){return a.replace("/"," ").replace(/\./g,"-")};this.formatDate=function(a){return a.replace(/([a-z]+)\s/i,function(a,c){return b.fm.i18n(c)+" "})};this.formatSize=function(a){var b=1,c="bytes";1073741824<a?(b=1073741824,c="Gb"):1048576<a?(b=1048576,c="Mb"):1024<a&&(b=1024,c="Kb");return Math.round(a/b)+" "+c};this.formatPermissions=function(a,c,d){var j=[];a&&j.push(b.fm.i18n("read"));c&&j.push(b.fm.i18n("write"));d&&j.push(b.fm.i18n("remove"));
return j.join("/")};this.mime2kind=function(a){return this.fm.i18n(this.kinds[a]||"unknown")}}})(jQuery);
(function(d){elFinder.prototype.ui=function(e){var c=this;this.fm=e;this.cmd={};this.buttons={};this.menu=d('<div class="el-finder-contextmenu" />').appendTo(document.body).hide();this.dockButton=d('<div class="el-finder-dock-button" title="'+c.fm.i18n("Dock/undock filemanager window")+'" />');this.exec=function(b,a){if(this.cmd[b]){if("open"!=b&&!this.cmd[b].isAllowed())return this.fm.view.error("Command not allowed");this.fm.locked||(this.fm.quickLook.hide(),d(".el-finder-info").remove(),this.cmd[b].exec(a),
this.update())}};this.cmdName=function(b){return this.cmd[b]&&this.cmd[b].name?"archive"==b&&1==this.fm.params.archives.length?this.fm.i18n("Create")+" "+this.fm.view.mime2kind(this.fm.params.archives[0]).toLowerCase():this.fm.i18n(this.cmd[b].name):b};this.isCmdAllowed=function(b){return c.cmd[b]&&c.cmd[b].isAllowed()};this.execIfAllowed=function(b){this.isCmdAllowed(b)&&this.exec(b)};this.includeInCm=function(b,a){return this.isCmdAllowed(b)&&this.cmd[b].cm(a)};this.showMenu=function(b){var a,g,
h,j,e;this.hideMenu();a=c.fm.selected.length?1==c.fm.selected.length?"file":"group":"cwd";var i=c.fm.options.contextmenu[a]||[];for(g=0;g<i.length;g++)if("delim"==i[g])c.menu.children().length&&!c.menu.children(":last").hasClass("delim")&&c.menu.append('<div class="delim" />');else if(c.fm.ui.includeInCm(i[g],a)){j=c.cmd[i[g]].argc();e="";if(j.length){e='<span/><div class="el-finder-contextmenu-sub" style="z-index:'+(parseInt(c.menu.css("z-index"))+1)+'">';for(h=0;h<j.length;h++)e+='<div name="'+
i[g]+'" argc="'+j[h].argc+'" class="'+j[h]["class"]+'">'+j[h].text+"</div>";e+="</div>"}c.menu.append('<div class="'+i[g]+'" name="'+i[g]+'">'+e+c.cmdName(i[g])+"</div>")}h=d(window);a=h.height();g=h.width();h=h.scrollTop();j=this.menu.width();e=this.menu.height();this.menu.css({left:b.clientX+j>g?b.clientX-j:b.clientX,top:b.clientY+e>a&&b.clientY>e?b.clientY+h-e:b.clientY+h}).show().find("div[name]").hover(function(){var a=d(this),b=a.children("div"),c;a.addClass("hover");b.length&&(b.attr("pos")||
(c=a.outerWidth(),b.css(d(window).width()-c-a.offset().left>b.width()?"left":"right",c-5).attr("pos",!0)),b.show())},function(){d(this).removeClass("hover").children("div").hide()}).click(function(a){a.stopPropagation();a=d(this);a.children("div").length||(c.hideMenu(),c.exec(a.attr("name"),a.attr("argc")))})};this.hideMenu=function(){this.menu.hide().empty()};this.update=function(){for(var b in this.buttons)this.buttons[b].toggleClass("disabled",!this.cmd[b].isAllowed())};this.init=function(b){var a,
g,h=!1,j=this.fm.options.toolbar;this.fm.options.editorCallback||b.push("select");!this.fm.params.archives.length&&-1==d.inArray("archive",b)&&b.push("archive");for(a in this.commands)-1==d.inArray(a,b)&&(this.commands[a].prototype=this.command.prototype,this.cmd[a]=new this.commands[a](this.fm));for(a=0;a<j.length;a++){h&&this.fm.view.tlb.append('<li class="delim" />');h=!1;for(b=0;b<j[a].length;b++)g=j[a][b],this.cmd[g]&&(h=!0,this.buttons[g]=d('<li class="'+g+'" title="'+this.cmdName(g)+'" name="'+
g+'" />').appendTo(this.fm.view.tlb).click(function(a){a.stopPropagation()}).bind("click",function(a){return function(){!d(this).hasClass("disabled")&&a.exec(d(this).attr("name"))}}(this)).hover(function(){!d(this).hasClass("disabled")&&d(this).addClass("el-finder-tb-hover")},function(){d(this).removeClass("el-finder-tb-hover")}))}this.update();this.menu.css("z-index",this.fm.zIndex);this.fm.options.docked&&this.dockButton.hover(function(){d(this).addClass("el-finder-dock-button-hover")},function(){d(this).removeClass("el-finder-dock-button-hover")}).click(function(){c.fm.view.win.attr("undocked")?
c.fm.dock():c.fm.undock();d(this).trigger("mouseout")}).prependTo(this.fm.view.tlb)}};elFinder.prototype.ui.prototype.command=function(){};elFinder.prototype.ui.prototype.command.prototype.isAllowed=function(){return!0};elFinder.prototype.ui.prototype.command.prototype.cm=function(){return!1};elFinder.prototype.ui.prototype.command.prototype.argc=function(){return[]};elFinder.prototype.ui.prototype.commands={back:function(d){var c=this;this.name="Back";this.fm=d;this.exec=function(){this.fm.history.length&&
this.fm.ajax({cmd:"open",target:this.fm.history.pop()},function(b){c.fm.reload(b)})};this.isAllowed=function(){return this.fm.history.length}},reload:function(d){var c=this;this.name="Reload";this.fm=d;this.exec=function(){this.fm.ajax({cmd:"open",target:this.fm.cwd.hash,tree:!0},function(b){c.fm.reload(b)})};this.cm=function(b){return"cwd"==b}},open:function(e){var c=this;this.name="Open";this.fm=e;this.exec=function(b){var a=null,a=b?{hash:d(b).attr("key"),mime:"directory",read:!d(b).hasClass("noaccess")&&
!d(b).hasClass("dropbox")}:this.fm.getSelected(0);if(a.hash){if(!a.read)return this.fm.view.error("Access denied");if("link"==a.type&&!a.link)return this.fm.view.error("Unable to open broken link");"directory"==a.mime?(b=a.link||a.hash,c.fm.history.push(c.fm.cwd.hash),c.fm.ajax({cmd:"open",target:b},function(a){c.fm.reload(a)})):(b=a,a="",b.dim&&(a=b.dim.split("x"),a="width="+(parseInt(a[0])+20)+",height="+(parseInt(a[1])+20)+","),window.open(b.url||c.fm.options.url+"?cmd=open&current="+(b.parent||
c.fm.cwd.hash)+"&target="+(b.link||b.hash),!1,"top=50,left=50,"+a+"scrollbars=yes,resizable=yes"))}};this.isAllowed=function(){return 1==this.fm.selected.length&&this.fm.getSelected(0).read};this.cm=function(b){return"file"==b}},select:function(e){this.name="Select file";this.fm=e;this.exec=e.options.selectMultiple?function(){var c=d(e.getSelected()).map(function(){return"root"==e.options.cutURL?this.url.substr(e.params.url.length):this.url.replace(RegExp("^("+e.options.cutURL+")"),"")});e.options.editorCallback(c);
e.options.closeOnEditorCallback&&(e.dock(),e.close())}:function(){var c=this.fm.getSelected(0);if(!c.url)return this.fm.view.error("File URL disabled by connector config");this.fm.options.editorCallback("root"==this.fm.options.cutURL?c.url.substr(this.fm.params.url.length):c.url.replace(RegExp("^("+this.fm.options.cutURL+")"),""));this.fm.options.closeOnEditorCallback&&(this.fm.dock(),this.fm.close(),this.fm.destroy())};this.isAllowed=function(){return(this.fm.options.selectMultiple&&1<=this.fm.selected.length||
1==this.fm.selected.length)&&!/(symlink\-broken|directory)/.test(this.fm.getSelected(0).mime)};this.cm=function(c){return"cwd"!=c}},quicklook:function(d){var c=this;this.name="Preview with Quick Look";this.fm=d;this.exec=function(){c.fm.quickLook.toggle()};this.isAllowed=function(){return 1==this.fm.selected.length};this.cm=function(){return!0}},info:function(e){var c=this;this.name="Get info";this.fm=e;this.exec=function(){function b(b){var e=["50%","50%"],i,l='<table cellspacing="0"><tr><td>'+c.fm.i18n("Name")+
"</td><td>"+b.name+"</td></tr><tr><td>"+c.fm.i18n("Kind")+"</td><td>"+c.fm.view.mime2kind(b.link?"symlink":b.mime)+"</td></tr><tr><td>"+c.fm.i18n("Size")+"</td><td>"+c.fm.view.formatSize(b.size)+"</td></tr><tr><td>"+c.fm.i18n("Modified")+"</td><td>"+c.fm.view.formatDate(b.date)+"</td></tr><tr><td>"+c.fm.i18n("Permissions")+"</td><td>"+c.fm.view.formatPermissions(b.read,b.write,b.rm)+"</td></tr>";b.link&&(l+="<tr><td>"+c.fm.i18n("Link to")+"</td><td>"+b.linkTo+"</td></tr>");b.dim&&(l+="<tr><td>"+c.fm.i18n("Dimensions")+
"</td><td>"+b.dim+" px.</td></tr>");b.url&&(l+="<tr><td>"+c.fm.i18n("URL")+'</td><td><a href="'+b.url+'" target="_blank">'+b.url+"</a></td></tr>");1<a&&(i=d(".el-finder-dialog-info:last"),i.length?(e=i.offset().left+10,i=i.offset().top+10,e=[e<g-350?e:20,i<h-300?i:20]):(e=Math.round((g-350)/2-10*a),i=Math.round((h-300)/2-10*a),e=[20<e?e:20,20<i?i:20]));d("<div />").append(l+"</table>").dialog({dialogClass:"el-finder-dialog el-finder-dialog-info",width:390,position:e,title:c.fm.i18n("directory"==b.mime?
"Folder info":"File info"),close:function(){0>=--a&&c.fm.lockShortcuts();d(this).dialog("destroy")},buttons:{Ok:function(){d(this).dialog("close")}}})}var a=this.fm.selected.length,g=d(window).width(),h=d(window).height();this.fm.lockShortcuts(!0);a?d.each(this.fm.getSelected(),function(){b(this)}):b(c.fm.cwd)};this.cm=function(){return!0}},rename:function(e){var c=this;this.name="Rename";this.fm=e;this.exec=function(){function b(){e.html(l);c.fm.lockShortcuts()}function a(){if(!c.fm.locked){var a,
d=k.val();if(i.name==k.val())return b();c.fm.isValidName(d)?c.fm.fileExists(d)&&(a="File or folder with the same name already exists"):a="Invalid name";if(a)return c.fm.view.error(a),h.addClass("ui-selected"),c.fm.lockShortcuts(!0),k.select().focus();c.fm.ajax({cmd:"rename",current:c.fm.cwd.hash,target:i.hash,name:d},function(a){a.error?b():("directory"==i.mime&&c.fm.removePlace(i.hash)&&c.fm.addPlace(a.target),c.fm.reload(a))},{force:!0})}}var g=this.fm.getSelected(),h,e,k,i,l;1==g.length&&(i=g[0],
h=this.fm.view.cwd.find('[key="'+i.hash+'"]'),e="icons"==this.fm.options.view?h.children("label"):h.find("td").eq(1),l=e.html(),k=d('<input type="text" />').val(i.name).appendTo(e.empty()).bind("change blur",a).keydown(function(a){a.stopPropagation();27==a.keyCode?b():13==a.keyCode&&(i.name==k.val()?b():d(this).trigger("change"))}).click(function(a){a.stopPropagation()}).select().focus(),this.fm.lockShortcuts(!0))};this.isAllowed=function(){return this.fm.cwd.write&&this.fm.getSelected(0).write};
this.cm=function(b){return"file"==b}},copy:function(d){this.name="Copy";this.fm=d;this.exec=function(){this.fm.setBuffer(this.fm.selected)};this.isAllowed=function(){if(this.fm.selected.length)for(var c=this.fm.getSelected(),b=c.length;b--;)if(c[b].read)return!0;return!1};this.cm=function(c){return"cwd"!=c}},cut:function(d){this.name="Cut";this.fm=d;this.exec=function(){this.fm.setBuffer(this.fm.selected,1)};this.isAllowed=function(){if(this.fm.selected.length)for(var c=this.fm.getSelected(),b=c.length;b--;)if(c[b].read&&
c[b].rm)return!0;return!1};this.cm=function(c){return"cwd"!=c}},paste:function(d){var c=this;this.name="Paste";this.fm=d;this.exec=function(){var b;this.fm.buffer.dst||(this.fm.buffer.dst=this.fm.cwd.hash);b=this.fm.view.tree.find('[key="'+this.fm.buffer.dst+'"]');if(!b.length||b.hasClass("noaccess")||b.hasClass("readonly"))return this.fm.view.error("Access denied");if(this.fm.buffer.src==this.fm.buffer.dst)return this.fm.view.error("Unable to copy into itself");b={cmd:"paste",current:this.fm.cwd.hash,
src:this.fm.buffer.src,dst:this.fm.buffer.dst,cut:this.fm.buffer.cut};132<this.fm.jquery?b.targets=this.fm.buffer.files:b["targets[]"]=this.fm.buffer.files;this.fm.ajax(b,function(a){a.cdc&&c.fm.reload(a)},{force:!0})};this.isAllowed=function(){return this.fm.buffer.files};this.cm=function(b){return"cwd"==b}},rm:function(e){var c=this;this.name="Remove";this.fm=e;this.exec=function(){var b,a=[],g=this.fm.getSelected();for(b=0;b<g.length;b++){if(!g[b].rm)return this.fm.view.error(g[b].name+": "+this.fm.i18n("Access denied"));
a.push(g[b].hash)}a.length&&(this.fm.lockShortcuts(!0),d('<div><div class="ui-state-error ui-corner-all"><span class="ui-icon ui-icon-alert"/><strong>'+this.fm.i18n("Are you sure you want to remove files?<br /> This cannot be undone!")+"</strong></div></div>").dialog({title:this.fm.i18n("Confirmation required"),dialogClass:"el-finder-dialog",width:350,close:function(){c.fm.lockShortcuts()},buttons:{Cancel:function(){d(this).dialog("close")},Ok:function(){d(this).dialog("close");var b={cmd:"rm",current:c.fm.cwd.hash};
132<c.fm.jquery?b.targets=a:b["targets[]"]=a;c.fm.ajax(b,function(a){a.tree&&c.fm.reload(a)},{force:!0})}}}))};this.isAllowed=function(){if(this.fm.selected.length)for(var b=this.fm.getSelected(),a=b.length;a--;)if(b[a].rm)return!0;return!1};this.cm=function(b){return"cwd"!=b}},mkdir:function(e){var c=this;this.name="New folder";this.fm=e;this.exec=function(){function b(){if(!c.fm.locked){var a,b=input.val();c.fm.isValidName(b)?c.fm.fileExists(b)&&(a="File or folder with the same name already exists"):
a="Invalid name";if(a)return c.fm.view.error(a),c.fm.lockShortcuts(!0),el.addClass("ui-selected"),input.select().focus();c.fm.ajax({cmd:"mkdir",current:c.fm.cwd.hash,name:b},function(a){if(a.error)return el.addClass("ui-selected"),input.select().focus();c.fm.reload(a)},{force:!0})}}c.fm.unselectAll();var a=this.fm.uniqueName("untitled folder");input=d('<input type="text"/>').val(a);prev=this.fm.view.cwd.find(".directory:last");f={name:a,hash:"",mime:"directory",read:!0,write:!0,date:"",size:0};el=
"list"==this.fm.options.view?d(this.fm.view.renderRow(f)).children("td").eq(1).empty().append(input).end().end():d(this.fm.view.renderIcon(f)).children("label").empty().append(input).end();el.addClass("directory ui-selected");prev.length?el.insertAfter(prev):"list"==this.fm.options.view?el.insertAfter(this.fm.view.cwd.find("tr").eq(0)):el.prependTo(this.fm.view.cwd);c.fm.checkSelectedPos();input.select().focus().click(function(a){a.stopPropagation()}).bind("change blur",b).keydown(function(a){a.stopPropagation();
27==a.keyCode?(el.remove(),c.fm.lockShortcuts()):13==a.keyCode&&b()});c.fm.lockShortcuts(!0)};this.isAllowed=function(){return this.fm.cwd.write};this.cm=function(b){return"cwd"==b}},mkfile:function(e){var c=this;this.name="New text file";this.fm=e;this.exec=function(){function b(){if(!c.fm.locked){var a,b=e.val();c.fm.isValidName(b)?c.fm.fileExists(b)&&(a="File or folder with the same name already exists"):a="Invalid name";if(a)return c.fm.view.error(a),c.fm.lockShortcuts(!0),h.addClass("ui-selected"),
e.select().focus();c.fm.ajax({cmd:"mkfile",current:c.fm.cwd.hash,name:b},function(a){if(a.error)return h.addClass("ui-selected"),e.select().focus();c.fm.reload(a)},{force:!0})}}c.fm.unselectAll();var a=this.fm.uniqueName("untitled file",".txt"),e=d('<input type="text"/>').val(a),a={name:a,hash:"",mime:"text/plain",read:!0,write:!0,date:"",size:0},h="list"==this.fm.options.view?d(this.fm.view.renderRow(a)).children("td").eq(1).empty().append(e).end().end():d(this.fm.view.renderIcon(a)).children("label").empty().append(e).end();
h.addClass("text ui-selected").appendTo("list"==this.fm.options.view?c.fm.view.cwd.children("table"):c.fm.view.cwd);e.select().focus().bind("change blur",b).click(function(a){a.stopPropagation()}).keydown(function(a){a.stopPropagation();27==a.keyCode?(h.remove(),c.fm.lockShortcuts()):13==a.keyCode&&b()});c.fm.lockShortcuts(!0)};this.isAllowed=function(){return this.fm.cwd.write};this.cm=function(b){return"cwd"==b}},upload:function(e){var c=this;this.name="Upload files";this.fm=e;this.exec=function(){function b(){function b(){try{j=
h.contentWindow?h.contentWindow.document:h.contentDocument?h.contentDocument:h.document;if(null==j.body||""==j.body.innerHTML){if(--g)return setTimeout(b,100);c.fm.lock();e.remove();return c.fm.view.error("Unable to access iframe DOM after 50 tries")}i=d(j.body).html();l=141<=c.fm.jquery?d.parseJSON(i):/^[\],:{}\s]*$/.test(i.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))?window.JSON&&
window.JSON.parse?window.JSON.parse(i):(new Function("return "+i))():{error:"Unable to parse server response"}}catch(a){l={error:"Unable to parse server response"}}c.fm.lock();e.remove();l.error&&c.fm.view.error(l.error,l.errorData);l.cwd&&c.fm.reload(l);l.tmb&&c.fm.tmb()}var e=d('<iframe name="'+a+'" name="'+a+'" src="about:blank"/>'),h=e[0],g=50,j,i,l;e.css({position:"absolute",top:"-1000px",left:"-1000px"}).appendTo("body").bind("load",function(){e.unbind("load");b()});c.fm.lock(!0);k.submit()}
for(var a="el-finder-io-"+(new Date).getTime(),e=d('<div class="ui-state-error ui-corner-all"><span class="ui-icon ui-icon-alert"/><div/></div>'),h=this.fm.params.uplMaxSize?"<p>"+this.fm.i18n("Maximum allowed files size")+": "+this.fm.params.uplMaxSize+"</p>":"",j=d('<p class="el-finder-add-field"><span class="ui-state-default ui-corner-all"><em class="ui-icon ui-icon-circle-plus"/></span>'+this.fm.i18n("Add field")+"</p>").click(function(){d(this).before('<p><input type="file" name="upload[]"/></p>')}),
k='<form method="post" enctype="multipart/form-data" action="'+c.fm.options.url+'" target="'+a+'"><input type="hidden" name="cmd" value="upload" /><input type="hidden" name="current" value="'+c.fm.cwd.hash+'" />',i=d("<div/>"),l=3;l--;)k+='<p><input type="file" name="upload[]"/></p>';var l=d("meta[name=csrf-token]").attr("content"),m=d("meta[name=csrf-param]").attr("content");null!=m&&null!=l&&(k+='<input name="'+m+'" value="'+l+'" type="hidden" />');k=d(k+"</form>");i.append(k.append(e.hide()).prepend(h).append(j)).dialog({dialogClass:"el-finder-dialog",
title:c.fm.i18n("Upload files"),modal:!0,resizable:!1,close:function(){c.fm.lockShortcuts()},buttons:{Cancel:function(){d(this).dialog("close")},Ok:function(){if(d(":file[value]",k).length)setTimeout(function(){c.fm.lock();d.browser.safari?d.ajax({url:c.fm.options.url,data:{cmd:"ping"},error:b,success:b}):b()}),d(this).dialog("close");else{var a=c.fm.i18n("Select at least one file to upload");e.show().find("div").empty().text(a)}}}});c.fm.lockShortcuts(!0)};this.isAllowed=function(){return this.fm.cwd.write};
this.cm=function(b){return"cwd"==b}},duplicate:function(d){var c=this;this.name="Duplicate";this.fm=d;this.exec=function(){this.fm.ajax({cmd:"duplicate",current:this.fm.cwd.hash,target:this.fm.selected[0]},function(b){c.fm.reload(b)})};this.isAllowed=function(){return this.fm.cwd.write&&1==this.fm.selected.length&&this.fm.getSelected()[0].read};this.cm=function(b){return"file"==b}},edit:function(e){var c=this;this.name="Edit text file";this.fm=e;this.exec=function(){var b=this.fm.getSelected(0);this.fm.lockShortcuts(!0);
this.fm.ajax({cmd:"read",current:this.fm.cwd.hash,target:b.hash},function(a){c.fm.lockShortcuts(!0);var e=d("<textarea/>").val(a.content||"").keydown(function(a){a.stopPropagation();if(9==a.keyCode)if(a.preventDefault(),d.browser.msie)a=document.selection.createRange(),a.text="\t"+a.text,this.focus();else{var a=this.value.substr(0,this.selectionStart),b=this.value.substr(this.selectionEnd);this.value=a+"\t"+b;this.setSelectionRange(a.length+1,a.length+1)}});d("<div/>").append(e).dialog({dialogClass:"el-finder-dialog",
title:c.fm.i18n(c.name),modal:!0,width:500,close:function(){c.fm.lockShortcuts()},buttons:{Cancel:function(){d(this).dialog("close")},Ok:function(){var a=e.val();d(this).dialog("close");c.fm.ajax({cmd:"edit",current:c.fm.cwd.hash,target:b.hash,content:a},function(a){a.target&&(c.fm.cdc[a.target.hash]=a.target,c.fm.view.updateFile(a.target),c.fm.selectById(a.target.hash))},{type:"POST"})}}})})};this.isAllowed=function(){if(1==c.fm.selected.length){var b=this.fm.getSelected()[0];return b.write&&b.read&&
(0==b.mime.indexOf("text")||"application/x-empty"==b.mime||"application/xml"==b.mime)}};this.cm=function(b){return"file"==b}},archive:function(e){var c=this;this.name="Create archive";this.fm=e;this.exec=function(b){b={cmd:"archive",current:c.fm.cwd.hash,type:-1!=d.inArray(b,this.fm.params.archives)?b:this.fm.params.archives[0],name:c.fm.i18n("Archive")};132<this.fm.jquery?b.targets=c.fm.selected:b["targets[]"]=c.fm.selected;this.fm.ajax(b,function(a){c.fm.reload(a)})};this.isAllowed=function(){if(this.fm.cwd.write&&
this.fm.selected.length)for(var b=this.fm.getSelected(),a=b.length;a--;)if(b[a].read)return!0;return!1};this.cm=function(b){return"cwd"!=b};this.argc=function(){var b,a=[];for(b=0;b<c.fm.params.archives.length;b++)a.push({"class":"archive",argc:c.fm.params.archives[b],text:c.fm.view.mime2kind(c.fm.params.archives[b])});return a}},extract:function(e){var c=this;this.name="Uncompress archive";this.fm=e;this.exec=function(){this.fm.ajax({cmd:"extract",current:this.fm.cwd.hash,target:this.fm.getSelected(0).hash},
function(b){c.fm.reload(b)})};this.isAllowed=function(){var b=this.fm.params.extract,a=b&&b.length;return this.fm.cwd.write&&1==this.fm.selected.length&&this.fm.getSelected(0).read&&a&&-1!=d.inArray(this.fm.getSelected(0).mime,b)};this.cm=function(b){return"file"==b}},resize:function(e){var c=this;this.name="Resize image";this.fm=e;this.exec=function(){function b(){var a=parseInt(iw.val())||0,b=parseInt(ih.val())||0;0>=a||0>=b?(a=h,b=j):this==iw.get(0)?b=parseInt(a/k):a=parseInt(b*k);iw.val(a);ih.val(b)}
var a=this.fm.getSelected();if(a[0]&&a[0].write&&a[0].dim){var e=a[0].dim.split("x"),h=parseInt(e[0]),j=parseInt(e[1]),k=h/j;iw=d('<input type="text" size="9" value="'+h+'" name="width"/>');ih=d('<input type="text" size="9" value="'+j+'" name="height"/>');f=d("<form/>").append(iw).append(" x ").append(ih).append(" px");iw.add(ih).bind("change",b);c.fm.lockShortcuts(!0);d("<div/>").append(d("<div/>").text(c.fm.i18n("Dimensions")+":")).append(f).dialog({title:c.fm.i18n("Resize image"),dialogClass:"el-finder-dialog",
width:230,modal:!0,close:function(){c.fm.lockShortcuts()},buttons:{Cancel:function(){d(this).dialog("close")},Ok:function(){var b=parseInt(iw.val())||0,e=parseInt(ih.val())||0;0<b&&(b!=h&&0<e&&e!=j)&&c.fm.ajax({cmd:"resize",current:c.fm.cwd.hash,target:a[0].hash,width:b,height:e},function(a){c.fm.reload(a)});d(this).dialog("close")}}})}};this.isAllowed=function(){return 1==this.fm.selected.length&&this.fm.cdc[this.fm.selected[0]].write&&this.fm.cdc[this.fm.selected[0]].read&&this.fm.cdc[this.fm.selected[0]].resize};
this.cm=function(b){return"file"==b}},icons:function(e){this.name="View as icons";this.fm=e;this.exec=function(){this.fm.view.win.addClass("el-finder-disabled");this.fm.setView("icons");this.fm.updateCwd();this.fm.view.win.removeClass("el-finder-disabled");d("div.image",this.fm.view.cwd).length&&this.fm.tmb()};this.isAllowed=function(){return"icons"!=this.fm.options.view};this.cm=function(c){return"cwd"==c}},list:function(d){this.name="View as list";this.fm=d;this.exec=function(){this.fm.view.win.addClass("el-finder-disabled");
this.fm.setView("list");this.fm.updateCwd();this.fm.view.win.removeClass("el-finder-disabled")};this.isAllowed=function(){return"list"!=this.fm.options.view};this.cm=function(c){return"cwd"==c}},help:function(e){this.name="Help";this.fm=e;this.exec=function(){var c,b=this.fm.i18n("helpText"),a;c='<div class="el-finder-logo"/><strong>'+this.fm.i18n("elFinder: Web file manager")+"</strong><br/>"+this.fm.i18n("Version")+": "+this.fm.version+"<br/>jQuery/jQueryUI: "+d().jquery+"/"+d.ui.version+'<br clear="all"/><p><strong><a href="http://elrte.org/'+
this.fm.options.lang+'/elfinder" target="_blank">'+this.fm.i18n("Donate to support project development")+'</a></strong></p><p><a href="http://elrte.org/redmine/projects/elfinder/wiki" target="_blank">'+this.fm.i18n("elFinder documentation")+"</a></p>";c=c+("<p>"+("helpText"!=b?b:"elFinder works similar to file manager on your computer. <br /> To make actions on files/folders use icons on top panel. If icon action it is not clear for you, hold mouse cursor over it to see the hint. <br /> Manipulations with existing files/folders can be done through the context menu (mouse right-click).<br/> To copy/delete a group of files/folders, select them using Shift/Alt(Command) + mouse left-click.")+
"</p>")+("<p><strong>"+this.fm.i18n("elFinder support following shortcuts")+":</strong><ul><li><kbd>Ctrl+A</kbd> - "+this.fm.i18n("Select all files")+"</li><li><kbd>Ctrl+C/Ctrl+X/Ctrl+V</kbd> - "+this.fm.i18n("Copy/Cut/Paste files")+"</li><li><kbd>Enter</kbd> - "+this.fm.i18n("Open selected file/folder")+"</li><li><kbd>Space</kbd> - "+this.fm.i18n("Open/close QuickLook window")+"</li><li><kbd>Delete/Cmd+Backspace</kbd> - "+this.fm.i18n("Remove selected files")+"</li><li><kbd>Ctrl+I</kbd> - "+this.fm.i18n("Selected files or current directory info")+
"</li><li><kbd>Ctrl+N</kbd> - "+this.fm.i18n("Create new directory")+"</li><li><kbd>Ctrl+U</kbd> - "+this.fm.i18n("Open upload files form")+"</li><li><kbd>Left arrow</kbd> - "+this.fm.i18n("Select previous file")+"</li><li><kbd>Right arrow </kbd> - "+this.fm.i18n("Select next file")+"</li><li><kbd>Ctrl+Right arrow</kbd> - "+this.fm.i18n("Open selected file/folder")+"</li><li><kbd>Ctrl+Left arrow</kbd> - "+this.fm.i18n("Return into previous folder")+"</li><li><kbd>Shift+arrows</kbd> - "+this.fm.i18n("Increase/decrease files selection")+
"</li></ul></p><p>"+this.fm.i18n("Contacts us if you need help integrating elFinder in you products")+": dev@std42.ru</p>");b='<div class="el-finder-help-std"/><p>'+this.fm.i18n("Javascripts/PHP programming: Dmitry (dio) Levashov, dio@std42.ru")+"</p><p>"+this.fm.i18n("Python programming, techsupport: Troex Nevelin, troex@fury.scancode.ru")+"</p><p>"+this.fm.i18n("Design: Valentin Razumnih")+"</p><p>"+this.fm.i18n("Chezh localization")+": Roman Mat\u011bna, info@romanmatena.cz</p><p>"+this.fm.i18n("Chinese (traditional) localization")+
": Tad, tad0616@gmail.com</p><p>"+this.fm.i18n("Dutch localization")+': Kurt Aerts, <a href="http://ilabsolutions.net/" target="_blank">http://ilabsolutions.net</a></p><p>'+this.fm.i18n("Greek localization")+": Panagiotis Skarvelis</p><p>"+this.fm.i18n("Hungarian localization")+": Viktor Tamas, tamas.viktor@totalstudio.hu</p><p>"+this.fm.i18n("Italian localization")+":  Ugo Punzolo, sadraczerouno@gmail.com</p><p>"+this.fm.i18n("Latvian localization")+":  Uldis Ploti\u0146\u0161, uldis.plotins@gmail.com</p><p>"+
this.fm.i18n("Poland localization")+":  Darek Wapi\u0144ski, darek@wapinski.us</p><p>"+this.fm.i18n("Spanish localization")+': Alex (xand) Vavilin, xand@xand.es, <a href="http://xand.es" target="_blank">http://xand.es</a></p><p>'+this.fm.i18n("Icons")+': <a href="http://pixelmixer.ru/" target="_blank">pixelmixer</a>,  <a href="http://www.famfamfam.com/lab/icons/silk/" target="_blank">Famfam silk icons</a>, <a href="http://www.fatcow.com/free-icons/" target="_blank">Fatcow icons</a></p><p>'+this.fm.i18n('Copyright: <a href="http://www.std42.ru" target="_blank">Studio 42 LTD</a>')+
"</p><p>"+this.fm.i18n("License: BSD License")+"</p><p>"+this.fm.i18n('Web site: <a href="http://elrte.org/elfinder/" target="_blank">elrte.org/elfinder</a>')+"</p>";a='<div class="el-finder-logo"/><strong><a href="http://www.eldorado-cms.ru" target="_blank">ELDORADO.CMS</a></strong><br/>'+this.fm.i18n("Simple and usefull Content Management System")+"<hr/>"+this.fm.i18n("Support project development and we will place here info about you");c='<ul><li><a href="#el-finder-help-h">'+this.fm.i18n("Help")+
'</a></li><li><a href="#el-finder-help-a">'+this.fm.i18n("Authors")+'</a><li><a href="#el-finder-help-sp">'+this.fm.i18n("Sponsors")+'</a></li></ul><div id="el-finder-help-h"><p>'+c+'</p></div><div id="el-finder-help-a"><p>'+b+'</p></div><div id="el-finder-help-sp"><p>'+a+"</p></div>";var e=d("<div/>").html(c).dialog({width:617,title:this.fm.i18n("Help"),dialogClass:"el-finder-dialog",modal:!0,close:function(){e.tabs("destroy").dialog("destroy").remove()},buttons:{Ok:function(){d(this).dialog("close")}}}).tabs()};
this.cm=function(c){return"cwd"==c}}}})(jQuery);
(function(d){elFinder.prototype.quickLook=function(e){function c(){a.media.hide().empty();a.win.attr("class","el-finder-ql").css("z-index",a.fm.zIndex);a.title.empty();a.ico.attr("style","").show();a.add.hide().empty();a._hash=""}function b(){var b=a.fm.getSelected(0);c();a._hash=b.hash;a.title.text(b.name);a.win.addClass(a.fm.view.mime2class(b.mime));a.name.text(b.name);a.kind.text(a.fm.view.mime2kind(b.link?"symlink":b.mime));a.size.text(a.fm.view.formatSize(b.size));a.date.text(a.fm.i18n("Modified")+
": "+a.fm.view.formatDate(b.date));b.dim&&a.add.append("<span>"+b.dim+" px</span>").show();b.tmb&&a.ico.css("background",'url("'+b.tmb+'") 0 0 no-repeat');if(b.url){a.url.text(b.url).attr("href",b.url).show();for(var d in a.plugins)if(a.plugins[d].test&&a.plugins[d].test(b.mime,a.mimes,b.name)){a.plugins[d].show(a,b);return}}else a.url.hide();a.win.css({width:"420px",height:"auto"})}var a=this;this.fm=e;this._hash="";this.title=d("<strong/>");this.ico=d("<p/>");this.info=d("<label/>");this.media=
d('<div class="el-finder-ql-media"/>').hide();this.name=d('<span class="el-finder-ql-name"/>');this.kind=d('<span class="el-finder-ql-kind"/>');this.size=d('<span class="el-finder-ql-size"/>');this.date=d('<span class="el-finder-ql-date"/>');this.url=d('<a href="#"/>').hide().click(function(b){b.preventDefault();window.open(d(this).attr("href"));a.hide()});this.add=d("<div/>");this.content=d('<div class="el-finder-ql-content"/>');this.win=d('<div class="el-finder-ql"/>').hide().append(d('<div class="el-finder-ql-drag-handle"/>').append(d('<span class="ui-icon ui-icon-circle-close"/>').click(function(){a.hide()})).append(this.title)).append(this.ico).append(this.media).append(this.content.append(this.name).append(this.kind).append(this.size).append(this.date).append(this.url).append(this.add)).appendTo("body").draggable({handle:".el-finder-ql-drag-handle"}).resizable({minWidth:420,
minHeight:150,resize:function(){if(a.media.children().length){var b=a.media.children(":first");switch(b[0].nodeName){case "IMG":var c=b.width(),d=b.height(),e=a.win.width(),h="auto"==a.win.css("height")?350:a.win.height()-a.content.height()-a.th,c=c>e||d>h?Math.min(Math.min(e,c)/c,Math.min(h,d)/d):Math.min(Math.max(e,c)/c,Math.max(h,d)/d);b.css({width:Math.round(b.width()*c),height:Math.round(b.height()*c)});break;case "IFRAME":case "EMBED":b.css("height",a.win.height()-a.content.height()-a.th);break;
case "OBJECT":b.children("embed").css("height",a.win.height()-a.content.height()-a.th)}}}});this.th=parseInt(this.win.children(":first").css("height"))||18;this.mimes={"image/jpeg":"jpg","image/gif":"gif","image/png":"png"};for(e=0;e<navigator.mimeTypes.length;e++){var g=navigator.mimeTypes[e].type;g&&"*"!=g&&(this.mimes[g]=navigator.mimeTypes[e].suffixes)}if(d.browser.safari&&-1!=navigator.platform.indexOf("Mac")||d.browser.msie)this.mimes["application/pdf"]="pdf";else for(e=0;e<navigator.plugins.length;e++)for(g=
0;g<navigator.plugins[e].length;g++){var h=navigator.plugins[e][g].description.toLowerCase();if("pdf"==h.substring(0,h.indexOf(" "))){this.mimes["application/pdf"]="pdf";break}}this.mimes["image/x-bmp"]&&(this.mimes["image/x-ms-bmp"]="bmp");d.browser.msie&&!this.mimes["application/x-shockwave-flash"]&&(this.mimes["application/x-shockwave-flash"]="swf");this.show=function(){if(this.win.is(":hidden")&&1==a.fm.selected.length){b();var c=a.fm.view.cwd.find('[key="'+a.fm.selected[0]+'"]'),e=c.offset();
a.fm.lockShortcuts(!0);this.win.css({width:c.width()-20,height:c.height(),left:e.left,top:e.top,opacity:0}).show().animate({width:420,height:150,opacity:1,top:Math.round(d(window).height()/5),left:d(window).width()/2-210},450,function(){a.win.css({height:"auto"});a.fm.lockShortcuts()})}};this.hide=function(){if(this.win.is(":visible")){var b,d=a.fm.view.cwd.find('[key="'+this._hash+'"]');d?(b=d.offset(),this.media.hide(200),this.win.animate({width:d.width()-20,height:d.height(),left:b.left,top:b.top,
opacity:0},350,function(){a.fm.lockShortcuts();c();a.win.hide().css("height","auto")})):(this.win.fadeOut(200),c(),a.fm.lockShortcuts())}};this.toggle=function(){this.win.is(":visible")?this.hide():this.show()};this.update=function(){1!=this.fm.selected.length?this.hide():this.win.is(":visible")&&this.fm.selected[0]!=this._hash&&b()};this.mediaHeight=function(){return this.win.is(":animated")||"auto"==this.win.css("height")?315:this.win.height()-this.content.height()-this.th}};elFinder.prototype.quickLook.prototype.plugins=
{image:new function(){this.test=function(d){return d.match(/^image\//)};this.show=function(e,c){function b(a){var b=a.width(),c=a.height(),d=e.win.is(":animated"),i=d?420:e.win.width(),d=d||"auto"==e.win.css("height")?315:e.win.height()-e.content.height()-e.th,i=b>i||c>d?Math.min(Math.min(i,b)/b,Math.min(d,c)/c):Math.min(Math.max(i,b)/b,Math.max(d,c)/c);e.fm.lockShortcuts(!0);e.ico.hide();a.css({width:e.ico.width(),height:e.ico.height()}).show().animate({width:Math.round(i*b),height:Math.round(i*
c)},450,function(){e.fm.lockShortcuts()})}var a;e.mimes[c.mime]&&c.hash==e._hash&&d("<img/>").hide().appendTo(e.media.show()).attr("src",c.url+(d.browser.msie||d.browser.opera?"?"+Math.random():"")).load(function(){a=d(this).unbind("load");c.hash==e._hash&&(e.win.is(":animated")?setTimeout(function(){b(a)},330):b(a))})}},text:new function(){this.test=function(d){return 0==d.indexOf("text")&&-1==d.indexOf("rtf")||d.match(/application\/(xml|javascript|json)/)};this.show=function(d,c){c.hash==d._hash&&
(d.ico.hide(),d.media.append('<iframe src="'+c.url+'" style="height:'+d.mediaHeight()+'px" />').show())}},swf:new function(){this.test=function(d,c){return"application/x-shockwave-flash"==d&&c[d]};this.show=function(d,c){if(c.hash==d._hash){d.ico.hide();var b=d.media.append('<embed pluginspage="http://www.macromedia.com/go/getflashplayer" quality="high" src="'+c.url+'" style="width:100%;height:'+d.mediaHeight()+'px" type="application/x-shockwave-flash" />');d.win.is(":animated")?b.slideDown(450):
b.show()}}},audio:new function(){this.test=function(d,c){return 0==d.indexOf("audio")&&c[d]};this.show=function(d,c){if(c.hash==d._hash){d.ico.hide();var b=d.win.is(":animated")||"auto"==d.win.css("height")?100:d.win.height()-d.content.height()-d.th;d.media.append('<embed src="'+c.url+'" style="width:100%;height:'+b+'px" />').show()}}},video:new function(){this.test=function(d,c){return 0==d.indexOf("video")&&c[d]};this.show=function(d,c){c.hash==d._hash&&(d.ico.hide(),d.media.append('<embed src="'+
c.url+'" style="width:100%;height:'+d.mediaHeight()+'px" />').show())}},pdf:new function(){this.test=function(d,c){return"application/pdf"==d&&c[d]};this.show=function(d,c){c.hash==d._hash&&(d.ico.hide(),d.media.append('<embed src="'+c.url+'" style="width:100%;height:'+d.mediaHeight()+'px" />').show())}}}})(jQuery);
(function(d){elFinder.prototype.eventsManager=function(e){function c(a,c){var h,e,k;if(d("[key]",b.cwd).length){if(0==b.fm.selected.length)h=d("[key]:"+(a?"first":"last"),b.cwd),b.fm.select(h);else if(c)h=d(".ui-selected:"+(a?"last":"first"),b.cwd),e=h[a?"next":"prev"]("[key]"),e.length&&(h=e),b.fm.select(h,!0);else{b.pointer&&(k=d('[key="'+b.pointer+'"].ui-selected',b.cwd));if(!k||!k.length)k=d(".ui-selected:"+(a?"last":"first"),b.cwd);h=k[a?"next":"prev"]("[key]");if(h.length)if(h.hasClass("ui-selected"))if(k.hasClass("ui-selected"))if(e=
k[a?"prev":"next"]("[key]"),!e.length||!e.hasClass("ui-selected"))b.fm.unselect(k);else{for(;(e=a?h.next("[key]"):h.prev("[key]"))&&h.hasClass("ui-selected");)h=e;b.fm.select(h)}else b.fm.unselect(h);else b.fm.select(h);else h=k}b.pointer=h.attr("key");b.fm.checkSelectedPos(a)}}var b=this;this.lock=!1;this.fm=e;this.ui=e.ui;this.tree=e.view.tree;this.cwd=e.view.cwd;this.pointer="";this.init=function(){var a=this,b=!1;a.lock=!1;this.cwd.bind("click",function(b){var c=d(b.target);c.hasClass("ui-selected")?
a.fm.unselectAll():(c.attr("key")||(c=c.parent("[key]")),b.ctrlKey||b.metaKey?a.fm.toggleSelect(c):a.fm.select(c,!0))}).bind(window.opera?"click":"contextmenu",function(c){if(!window.opera||c.ctrlKey){c.preventDefault();c.stopPropagation();var e=d(c.target);d.browser.mozilla&&(b=!0);e.hasClass("el-finder-cwd")?a.fm.unselectAll():a.fm.select(e.attr("key")?e:e.parent("[key]"));a.fm.quickLook.hide();a.fm.ui.showMenu(c)}}).selectable({filter:"[key]",delay:300,stop:function(){a.fm.updateSelect();a.fm.log("mouseup")}});
d(document).bind("click",function(c){!b&&a.fm.ui.hideMenu();b=!1;d("input",a.cwd).trigger("change");d(c.target).is("input,textarea,select")||d("input,textarea").blur()});d("input,textarea").live("focus",function(){a.lock=!0}).live("blur",function(){a.lock=!1});this.tree.bind("select",function(b){a.tree.find("a").removeClass("selected");d(b.target).addClass("selected").parents("li:has(ul)").children("ul").show().prev().children("div").addClass("expanded")});this.fm.options.places&&(this.fm.view.plc.click(function(b){b.preventDefault();
var c=d(b.target).attr("key");if(c)c!=a.fm.cwd.hash&&a.ui.exec("open",b.target);else if("A"==b.target.nodeName||"DIV"==b.target.nodeName)b=a.fm.view.plc.find("ul"),b.children().length&&(b.toggle(300),a.fm.view.plc.children("li").find("div").toggleClass("expanded"))}),this.fm.view.plc.droppable({accept:"div.directory, tr.directory",tolerance:"pointer",over:function(){d(this).addClass("el-finder-droppable")},out:function(){d(this).removeClass("el-finder-droppable")},drop:function(b,c){d(this).removeClass("el-finder-droppable");
var e=!1;c.helper.children(".directory:not(.noaccess,.dropbox)").each(function(){a.fm.addPlace(d(this).attr("key"))&&(e=!0,d(this).hide())});e&&(a.fm.view.renderPlaces(),a.updatePlaces(),a.fm.view.plc.children("li").children("div").trigger("click"));c.helper.children("div:visible").length||c.helper.hide()}}));d(document).bind(d.browser.mozilla||d.browser.opera?"keypress":"keydown",function(b){var d=b.ctrlKey||b.metaKey;if(!a.lock)switch(b.keyCode){case 37:case 38:b.stopPropagation();b.preventDefault();
37==b.keyCode&&d?a.ui.execIfAllowed("back"):c(!1,!b.shiftKey);break;case 39:case 40:b.stopPropagation(),b.preventDefault(),d?a.ui.execIfAllowed("open"):c(!0,!b.shiftKey)}});d(document).bind(d.browser.opera?"keypress":"keydown",function(b){if(!a.lock)switch(b.keyCode){case 32:b.preventDefault();b.stopPropagation();a.fm.quickLook.toggle();break;case 27:a.fm.quickLook.hide()}});this.fm.options.disableShortcuts||d(document).bind("keydown",function(b){var c=b.ctrlKey||b.metaKey;if(!a.lock)switch(b.keyCode){case 8:c&&
a.ui.isCmdAllowed("rm")&&(b.preventDefault(),a.ui.exec("rm"));break;case 13:if(a.ui.isCmdAllowed("select"))return a.ui.exec("select");a.ui.execIfAllowed("open");break;case 46:a.ui.execIfAllowed("rm");break;case 65:c&&(b.preventDefault(),a.fm.selectAll());break;case 67:c&&a.ui.execIfAllowed("copy");break;case 73:c&&(b.preventDefault(),a.ui.exec("info"));break;case 78:c&&(b.preventDefault(),a.ui.execIfAllowed("mkdir"));break;case 85:c&&(b.preventDefault(),a.ui.execIfAllowed("upload"));break;case 86:c&&
a.ui.execIfAllowed("paste");break;case 88:c&&a.ui.execIfAllowed("cut");break;case 113:a.ui.execIfAllowed("rename")}})};this.updateNav=function(){d("a",this.tree).click(function(a){a.preventDefault();var c=d(this);"DIV"==a.target.nodeName&&d(a.target).hasClass("collapsed")?d(a.target).toggleClass("expanded").parent().next("ul").toggle(300):c.attr("key")!=b.fm.cwd.hash?c.hasClass("noaccess")||c.hasClass("dropbox")?b.fm.view.error("Access denied"):b.ui.exec("open",c.trigger("select")[0]):(a=c.children(".collapsed"),
a.length&&(a.toggleClass("expanded"),c.next("ul").toggle(300)))});d("a:not(.noaccess,.readonly)",this.tree).droppable({tolerance:"pointer",accept:"div[key],tr[key]",over:function(){d(this).addClass("el-finder-droppable")},out:function(){d(this).removeClass("el-finder-droppable")},drop:function(a,c){d(this).removeClass("el-finder-droppable");b.fm.drop(a,c,d(this).attr("key"))}});this.fm.options.places&&this.updatePlaces()};this.updatePlaces=function(){this.fm.view.plc.children("li").find("li").draggable({scroll:!1,
stop:function(){b.fm.removePlace(d(this).children("a").attr("key"))&&(d(this).remove(),d("li",b.fm.view.plc.children("li")).length||b.fm.view.plc.children("li").find("div").removeClass("collapsed expanded").end().children("ul").hide())}})};this.updateCwd=function(){d("[key]",this.cwd).bind("dblclick",function(){b.fm.select(d(this),!0);b.ui.exec(b.ui.isCmdAllowed("select")?"select":"open")}).draggable({delay:3,addClasses:!1,appendTo:".el-finder-cwd",revert:!0,drag:function(a,b){b.helper.toggleClass("el-finder-drag-copy",
a.shiftKey||a.ctrlKey)},helper:function(){var a=d(this),c=d('<div class="el-finder-drag-helper"/>'),e=0;!a.hasClass("ui-selected")&&b.fm.select(a,!0);b.cwd.find(".ui-selected").each(function(){var a="icons"==b.fm.options.view?d(this).clone().removeClass("ui-selected"):d(b.fm.view.renderIcon(b.fm.cdc[d(this).attr("key")]));(0==e++||0==e%12)&&a.css("margin-left",0);c.append(a)});return c.css("width",(12>=e?85+29*(e-1):387)+"px")}}).filter(".directory").droppable({tolerance:"pointer",accept:"div[key],tr[key]",
over:function(){d(this).addClass("el-finder-droppable")},out:function(){d(this).removeClass("el-finder-droppable")},drop:function(a,c){d(this).removeClass("el-finder-droppable");b.fm.drop(a,c,d(this).attr("key"))}});d.browser.msie&&d("*",this.cwd).attr("unselectable","on").filter("[key]").bind("dragstart",function(){b.cwd.selectable("disable").removeClass("ui-state-disabled ui-selectable-disabled")}).bind("dragstop",function(){b.cwd.selectable("enable")})}}})(jQuery);